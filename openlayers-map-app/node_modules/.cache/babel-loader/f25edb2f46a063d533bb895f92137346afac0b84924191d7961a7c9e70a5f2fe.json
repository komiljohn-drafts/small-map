{"ast":null,"code":"/**\n * @module ol/renderer/Composite\n */\nimport BaseVectorLayer from '../layer/BaseVector.js';\nimport MapRenderer from './Map.js';\nimport ObjectEventType from '../ObjectEventType.js';\nimport RenderEvent from '../render/Event.js';\nimport RenderEventType from '../render/EventType.js';\nimport { CLASS_UNSELECTABLE } from '../css.js';\nimport { checkedFonts } from '../render/canvas.js';\nimport { inView } from '../layer/Layer.js';\nimport { listen, unlistenByKey } from '../events.js';\nimport { replaceChildren } from '../dom.js';\n\n/**\n * @classdesc\n * Canvas map renderer.\n * @api\n */\nclass CompositeMapRenderer extends MapRenderer {\n  /**\n   * @param {import(\"../Map.js\").default} map Map.\n   */\n  constructor(map) {\n    super(map);\n\n    /**\n     * @private\n     * @type {import(\"../events.js\").EventsKey}\n     */\n    this.fontChangeListenerKey_ = listen(checkedFonts, ObjectEventType.PROPERTYCHANGE, map.redrawText.bind(map));\n\n    /**\n     * @private\n     * @type {HTMLDivElement}\n     */\n    this.element_ = document.createElement('div');\n    const style = this.element_.style;\n    style.position = 'absolute';\n    style.width = '100%';\n    style.height = '100%';\n    style.zIndex = '0';\n    this.element_.className = CLASS_UNSELECTABLE + ' ol-layers';\n    const container = map.getViewport();\n    container.insertBefore(this.element_, container.firstChild || null);\n\n    /**\n     * @private\n     * @type {Array<HTMLElement>}\n     */\n    this.children_ = [];\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.renderedVisible_ = true;\n  }\n\n  /**\n   * @param {import(\"../render/EventType.js\").default} type Event type.\n   * @param {import(\"../Map.js\").FrameState} frameState Frame state.\n   * @override\n   */\n  dispatchRenderEvent(type, frameState) {\n    const map = this.getMap();\n    if (map.hasListener(type)) {\n      const event = new RenderEvent(type, undefined, frameState);\n      map.dispatchEvent(event);\n    }\n  }\n\n  /**\n   * @override\n   */\n  disposeInternal() {\n    unlistenByKey(this.fontChangeListenerKey_);\n    this.element_.remove();\n    super.disposeInternal();\n  }\n\n  /**\n   * Render.\n   * @param {?import(\"../Map.js\").FrameState} frameState Frame state.\n   * @override\n   */\n  renderFrame(frameState) {\n    if (!frameState) {\n      if (this.renderedVisible_) {\n        this.element_.style.display = 'none';\n        this.renderedVisible_ = false;\n      }\n      return;\n    }\n    this.calculateMatrices2D(frameState);\n    this.dispatchRenderEvent(RenderEventType.PRECOMPOSE, frameState);\n    const layerStatesArray = frameState.layerStatesArray.sort((a, b) => a.zIndex - b.zIndex);\n    const declutter = layerStatesArray.some(layerState => layerState.layer instanceof BaseVectorLayer && layerState.layer.getDeclutter());\n    if (declutter) {\n      // Some layers need decluttering, turn on deferred rendering hint\n      frameState.declutter = {};\n    }\n    const viewState = frameState.viewState;\n    this.children_.length = 0;\n    const renderedLayerStates = [];\n    let previousElement = null;\n    for (let i = 0, ii = layerStatesArray.length; i < ii; ++i) {\n      const layerState = layerStatesArray[i];\n      frameState.layerIndex = i;\n      const layer = layerState.layer;\n      const sourceState = layer.getSourceState();\n      if (!inView(layerState, viewState) || sourceState != 'ready' && sourceState != 'undefined') {\n        layer.unrender();\n        continue;\n      }\n      const element = layer.render(frameState, previousElement);\n      if (!element) {\n        continue;\n      }\n      if (element !== previousElement) {\n        this.children_.push(element);\n        previousElement = element;\n      }\n      renderedLayerStates.push(layerState);\n    }\n    this.declutter(frameState, renderedLayerStates);\n    replaceChildren(this.element_, this.children_);\n    this.dispatchRenderEvent(RenderEventType.POSTCOMPOSE, frameState);\n    if (!this.renderedVisible_) {\n      this.element_.style.display = '';\n      this.renderedVisible_ = true;\n    }\n    this.scheduleExpireIconCache(frameState);\n  }\n\n  /**\n   * @param {import(\"../Map.js\").FrameState} frameState Frame state.\n   * @param {Array<import('../layer/Layer.js').State>} layerStates Layers.\n   */\n  declutter(frameState, layerStates) {\n    if (!frameState.declutter) {\n      return;\n    }\n    for (let i = layerStates.length - 1; i >= 0; --i) {\n      const layerState = layerStates[i];\n      const layer = layerState.layer;\n      if (layer.getDeclutter()) {\n        layer.renderDeclutter(frameState, layerState);\n      }\n    }\n    layerStates.forEach(layerState => layerState.layer.renderDeferred(frameState));\n  }\n}\nexport default CompositeMapRenderer;","map":{"version":3,"names":["BaseVectorLayer","MapRenderer","ObjectEventType","RenderEvent","RenderEventType","CLASS_UNSELECTABLE","checkedFonts","inView","listen","unlistenByKey","replaceChildren","CompositeMapRenderer","constructor","map","fontChangeListenerKey_","PROPERTYCHANGE","redrawText","bind","element_","document","createElement","style","position","width","height","zIndex","className","container","getViewport","insertBefore","firstChild","children_","renderedVisible_","dispatchRenderEvent","type","frameState","getMap","hasListener","event","undefined","dispatchEvent","disposeInternal","remove","renderFrame","display","calculateMatrices2D","PRECOMPOSE","layerStatesArray","sort","a","b","declutter","some","layerState","layer","getDeclutter","viewState","length","renderedLayerStates","previousElement","i","ii","layerIndex","sourceState","getSourceState","unrender","element","render","push","POSTCOMPOSE","scheduleExpireIconCache","layerStates","renderDeclutter","forEach","renderDeferred"],"sources":["/Users/komiljohn/TestTasks/osm-prosight-dev/openlayers-map-app/node_modules/ol/renderer/Composite.js"],"sourcesContent":["/**\n * @module ol/renderer/Composite\n */\nimport BaseVectorLayer from '../layer/BaseVector.js';\nimport MapRenderer from './Map.js';\nimport ObjectEventType from '../ObjectEventType.js';\nimport RenderEvent from '../render/Event.js';\nimport RenderEventType from '../render/EventType.js';\nimport {CLASS_UNSELECTABLE} from '../css.js';\nimport {checkedFonts} from '../render/canvas.js';\nimport {inView} from '../layer/Layer.js';\nimport {listen, unlistenByKey} from '../events.js';\nimport {replaceChildren} from '../dom.js';\n\n/**\n * @classdesc\n * Canvas map renderer.\n * @api\n */\nclass CompositeMapRenderer extends MapRenderer {\n  /**\n   * @param {import(\"../Map.js\").default} map Map.\n   */\n  constructor(map) {\n    super(map);\n\n    /**\n     * @private\n     * @type {import(\"../events.js\").EventsKey}\n     */\n    this.fontChangeListenerKey_ = listen(\n      checkedFonts,\n      ObjectEventType.PROPERTYCHANGE,\n      map.redrawText.bind(map),\n    );\n\n    /**\n     * @private\n     * @type {HTMLDivElement}\n     */\n    this.element_ = document.createElement('div');\n    const style = this.element_.style;\n    style.position = 'absolute';\n    style.width = '100%';\n    style.height = '100%';\n    style.zIndex = '0';\n\n    this.element_.className = CLASS_UNSELECTABLE + ' ol-layers';\n\n    const container = map.getViewport();\n    container.insertBefore(this.element_, container.firstChild || null);\n\n    /**\n     * @private\n     * @type {Array<HTMLElement>}\n     */\n    this.children_ = [];\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.renderedVisible_ = true;\n  }\n\n  /**\n   * @param {import(\"../render/EventType.js\").default} type Event type.\n   * @param {import(\"../Map.js\").FrameState} frameState Frame state.\n   * @override\n   */\n  dispatchRenderEvent(type, frameState) {\n    const map = this.getMap();\n    if (map.hasListener(type)) {\n      const event = new RenderEvent(type, undefined, frameState);\n      map.dispatchEvent(event);\n    }\n  }\n\n  /**\n   * @override\n   */\n  disposeInternal() {\n    unlistenByKey(this.fontChangeListenerKey_);\n    this.element_.remove();\n    super.disposeInternal();\n  }\n\n  /**\n   * Render.\n   * @param {?import(\"../Map.js\").FrameState} frameState Frame state.\n   * @override\n   */\n  renderFrame(frameState) {\n    if (!frameState) {\n      if (this.renderedVisible_) {\n        this.element_.style.display = 'none';\n        this.renderedVisible_ = false;\n      }\n      return;\n    }\n\n    this.calculateMatrices2D(frameState);\n    this.dispatchRenderEvent(RenderEventType.PRECOMPOSE, frameState);\n\n    const layerStatesArray = frameState.layerStatesArray.sort(\n      (a, b) => a.zIndex - b.zIndex,\n    );\n    const declutter = layerStatesArray.some(\n      (layerState) =>\n        layerState.layer instanceof BaseVectorLayer &&\n        layerState.layer.getDeclutter(),\n    );\n    if (declutter) {\n      // Some layers need decluttering, turn on deferred rendering hint\n      frameState.declutter = {};\n    }\n    const viewState = frameState.viewState;\n\n    this.children_.length = 0;\n\n    const renderedLayerStates = [];\n    let previousElement = null;\n    for (let i = 0, ii = layerStatesArray.length; i < ii; ++i) {\n      const layerState = layerStatesArray[i];\n      frameState.layerIndex = i;\n\n      const layer = layerState.layer;\n      const sourceState = layer.getSourceState();\n      if (\n        !inView(layerState, viewState) ||\n        (sourceState != 'ready' && sourceState != 'undefined')\n      ) {\n        layer.unrender();\n        continue;\n      }\n\n      const element = layer.render(frameState, previousElement);\n      if (!element) {\n        continue;\n      }\n      if (element !== previousElement) {\n        this.children_.push(element);\n        previousElement = element;\n      }\n\n      renderedLayerStates.push(layerState);\n    }\n\n    this.declutter(frameState, renderedLayerStates);\n\n    replaceChildren(this.element_, this.children_);\n\n    this.dispatchRenderEvent(RenderEventType.POSTCOMPOSE, frameState);\n\n    if (!this.renderedVisible_) {\n      this.element_.style.display = '';\n      this.renderedVisible_ = true;\n    }\n\n    this.scheduleExpireIconCache(frameState);\n  }\n\n  /**\n   * @param {import(\"../Map.js\").FrameState} frameState Frame state.\n   * @param {Array<import('../layer/Layer.js').State>} layerStates Layers.\n   */\n  declutter(frameState, layerStates) {\n    if (!frameState.declutter) {\n      return;\n    }\n    for (let i = layerStates.length - 1; i >= 0; --i) {\n      const layerState = layerStates[i];\n      const layer = layerState.layer;\n      if (layer.getDeclutter()) {\n        layer.renderDeclutter(frameState, layerState);\n      }\n    }\n    layerStates.forEach((layerState) =>\n      layerState.layer.renderDeferred(frameState),\n    );\n  }\n}\n\nexport default CompositeMapRenderer;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}